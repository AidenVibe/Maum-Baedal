# Feature Plan — today-page: 통합 홈페이지 (핵심 페이지)

## 1) 목표/배경 (Why)
- **문제 정의**: 사용자가 매일 접속하는 핵심 페이지로, 질문 확인 → 답변 입력 → 게이트 대기 → 공개 플로우를 한 곳에서 처리
- **사용자 가치**: "오늘의 질문"에 집중할 수 있는 심플한 UX
- **비즈니스 가치**: 일일 사용률과 완료율을 극대화하는 핵심 페이지

## 2) 성공 기준 (Acceptance Criteria)
- [ ] **질문 표시**: 당일 Assignment의 질문이 명확히 보임
- [ ] **답변 입력**: 간단한 텍스트 입력으로 답변 제출 가능
- [ ] **게이트 상태 표시**: 
  - 내 답변만: "상대방 답변 기다리는 중..."
  - 양측 답변 완료: 즉시 대화 공개 + 리다이렉트
- [ ] **질문 교체**: 답변 0건일 때만 1회 교체 가능
- [ ] **카운트다운**: 05:00 마감까지 남은 시간 표시
- [ ] **모바일 최적화**: 448px 이하에서 완벽 동작

## 3) 에러/엣지 케이스
- [ ] Assignment 없음 → 자동 생성 또는 에러 페이지
- [ ] 이미 답변 완료 → 읽기 전용 모드
- [ ] 질문 교체 제한 초과 → 교체 버튼 비활성화
- [ ] 05:00 이후 접속 → 새로운 Assignment 자동 생성
- [ ] 네트워크 오류 → 답변 임시저장 기능

## 4) 설계 (How)

### 아키텍처 개요
```
/today 페이지
├── TodayHeader (카운트다운 + 서비스 데이)
├── QuestionCard (질문 + 교체 버튼)
├── AnswerForm (답변 입력/수정)
├── GateStatus (대기/공개 상태)
└── MobileNav (하단 네비게이션)
```

### 데이터 흐름
```
1. Assignment 조회/생성 (GET /api/today)
2. 답변 제출 (POST /api/answer)
3. 게이트 체크 → Conversation 생성
4. 질문 교체 (POST /api/today/swap)
```

### 상태 관리
- **로컬 상태**: 답변 텍스트, 로딩, 에러
- **서버 상태**: Assignment, 답변, 게이트 상태
- **실시간 업데이트**: 상대방 답변 완료 시 자동 갱신

### UI 변화 요약
- **기존**: 분산된 질문/답변 페이지
- **신규**: 통합된 단일 페이지 UX
- **특징**: 카운트다운 + 게이트 시각화 + 모바일 퍼스트

## 5) 구현 계획 (Tasks)
- [ ] **Step 1: 기본 페이지 구조**
  - [ ] `/app/today/page.tsx` 생성
  - [ ] TodayHeader, QuestionCard 컴포넌트 구조 
  - [ ] 실행: `npm run typecheck && npm run lint`
  
- [ ] **Step 2: API 연동**
  - [ ] `/api/today` GET 엔드포인트 구현
  - [ ] Assignment 조회/생성 로직
  - [ ] 실행: `npm run build && npm run test`
  
- [ ] **Step 3: 답변 시스템**
  - [ ] AnswerForm 컴포넌트 구현
  - [ ] `/api/answer` POST 엔드포인트
  - [ ] 게이트 상태 체크 로직
  - [ ] 실행: `npm run typecheck`
  
- [ ] **Step 4: 질문 교체**
  - [ ] `/api/today/swap` POST 엔드포인트
  - [ ] 1회 제한 검증 로직
  - [ ] 실행: `npm run lint && npm run test`
  
- [ ] **Step 5: 실시간 UX**
  - [ ] 카운트다운 타이머 구현
  - [ ] 게이트 상태 시각화
  - [ ] 모바일 반응형 완성
  - [ ] 실행: `npm run build`

## 6) 테스트 계획
### 단위 테스트
- `lib/service-day.ts` - 05시 기준 날짜 계산
- `lib/gate.ts` - 게이트 공개 로직
- API 엔드포인트 응답 검증

### 통합 테스트
- Assignment 생성 → 답변 → 게이트 공개 플로우
- 질문 교체 제한 검증
- 에러 상황별 UI 반응

### E2E 시나리오
- 사용자 A, B가 동시에 답변 → 게이트 공개
- 카운트다운 0초 → 새로운 Assignment 생성

## 7) 롤아웃/모니터링
### 배포 전략
- **스테이징**: Vercel preview 배포로 기능 검증
- **프로덕션**: 점진적 사용자 공개 (베타 테스트)

### 핵심 메트릭
- **답변 시작률**: 방문자 대비 답변 입력 비율
- **완료율**: 양측 답변 완료 비율  
- **질문 교체율**: 교체 사용 빈도
- **체류 시간**: 페이지 평균 체류 시간

### 로그/알림
- 답변 제출 성공/실패
- 게이트 공개 이벤트
- API 응답 시간 모니터링

## 8) 오픈 퀘스천
- [ ] **카운트다운 정확성**: 서버-클라이언트 시간 동기화 방법?
- [ ] **실시간 업데이트**: WebSocket vs Polling vs Server-Sent Events?
- [ ] **오프라인 지원**: 답변 임시저장 스토리지 전략?
- [ ] **접근성**: 스크린 리더용 게이트 상태 알림 방법?

## 9) 변경 로그 (Living)
- **2025-08-27**: 초안 작성 - 통합 홈페이지 컨셉 및 기본 구조 정의
- **2025-08-27**: 카운트다운 + 게이트 시각화 요구사항 추가
- **2025-08-27**: 모바일 퍼스트 UX 고려사항 반영

## 10) 의존성 체크
### 선행 요구사항
- [x] Prisma 스키마 정의 (Assignment, Answer, Question)
- [x] NextAuth.js 카카오 인증 설정
- [ ] shadcn/ui 컴포넌트 셋업
- [ ] 서비스 데이 로직 구현 (`lib/service-day.ts`)

### 후속 작업 연결
- **gate-system.plan.md**: 게이트 공개 시스템과 긴밀히 연동
- **daily-reset-5am.plan.md**: 05시 리셋과 Assignment 생성 연동
- **admin-tools.plan.md**: 관리자 도구에서 해당 페이지 모니터링